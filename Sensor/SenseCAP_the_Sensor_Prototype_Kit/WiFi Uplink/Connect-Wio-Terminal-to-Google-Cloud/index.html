<!doctype html>
<html lang="en-US" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Sensor/SenseCAP_the_Sensor_Prototype_Kit/WiFi Uplink/Connect-Wio-Terminal-to-Google-Cloud">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Google Cloud IoT | Seeed Studio Wiki</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://c1ev0ps.github.io/docusaurus_wiki/Sensor/SenseCAP_the_Sensor_Prototype_Kit/WiFi Uplink/Connect-Wio-Terminal-to-Google-Cloud"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Google Cloud IoT | Seeed Studio Wiki"><meta data-rh="true" name="description" content="Google Cloud IoT"><meta data-rh="true" property="og:description" content="Google Cloud IoT"><meta data-rh="true" name="keywords" content="SenseCap"><meta data-rh="true" property="og:image" content="https://files.seeedstudio.com/wiki/wiki-platform/S.png"><meta data-rh="true" name="twitter:image" content="https://files.seeedstudio.com/wiki/wiki-platform/S.png"><link data-rh="true" rel="icon" href="/docusaurus_wiki/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://c1ev0ps.github.io/docusaurus_wiki/Sensor/SenseCAP_the_Sensor_Prototype_Kit/WiFi Uplink/Connect-Wio-Terminal-to-Google-Cloud"><link data-rh="true" rel="alternate" href="https://c1ev0ps.github.io/docusaurus_wiki/Sensor/SenseCAP_the_Sensor_Prototype_Kit/WiFi Uplink/Connect-Wio-Terminal-to-Google-Cloud" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://c1ev0ps.github.io/docusaurus_wiki/zh-CN/Sensor/SenseCAP_the_Sensor_Prototype_Kit/WiFi Uplink/Connect-Wio-Terminal-to-Google-Cloud" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://c1ev0ps.github.io/docusaurus_wiki/Sensor/SenseCAP_the_Sensor_Prototype_Kit/WiFi Uplink/Connect-Wio-Terminal-to-Google-Cloud" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://8182LB8Y0D-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/docusaurus_wiki/blog/rss.xml" title="Seeed Studio Wiki RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docusaurus_wiki/blog/atom.xml" title="Seeed Studio Wiki Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Seeed Studio Wiki" href="/docusaurus_wiki/opensearch.xml">
<link rel="icon" href="/docusaurus_wiki/img/docusaurus.png">
<link rel="manifest" href="/docusaurus_wiki/manifest.json">
<meta name="theme-color" content="rgb(37, 194, 160)">


<script src="https://viewer.altium.com/client/static/js/embed.js" async></script><link rel="stylesheet" href="/docusaurus_wiki/assets/css/styles.2eda7060.css">
<link rel="preload" href="/docusaurus_wiki/assets/js/runtime~main.8f55fba0.js" as="script">
<link rel="preload" href="/docusaurus_wiki/assets/js/main.3a7959e5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="content_knG7 announcementBarContent_xLdY">We are looking forward to your contribution! Welcome come to our <a target="_blank" rel="https://github.com/orgs/c1ev0ps/projects/3/views/1" href="#">Task Project</a></div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docusaurus_wiki/"><div class="navbar__logo"><img src="https://files.seeedstudio.com/wiki/wiki-platform/S.png" alt="Seeed Studio" class="themedImage_ToTc themedImage--light_HNdA navbar_logo_items"><img src="https://files.seeedstudio.com/wiki/wiki-platform/S.png" alt="Seeed Studio" class="themedImage_ToTc themedImage--dark_i4oU navbar_logo_items"></div></a><a class="navbar__item navbar__link navbar_doc_items" href="/docusaurus_wiki/Getting_Started">Getting Started</a><a class="navbar__item navbar__link navbar_doc_items" href="/docusaurus_wiki/Sensor_Network">Sensor Network</a><a class="navbar__item navbar__link navbar_doc_items" href="/docusaurus_wiki/Edge_Computing">Edge Computing</a><a class="navbar__item navbar__link navbar_doc_items" href="/docusaurus_wiki/CloudnChain">Cloud &amp; Chain</a><a class="navbar__item navbar__link navbar_doc_items" href="/docusaurus_wiki/Solutions">Solutions</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/c1ev0ps/docusaurus_wiki" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar_doc_items">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link navbar_doc_items"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docusaurus_wiki/Sensor/SenseCAP_the_Sensor_Prototype_Kit/WiFi Uplink/Connect-Wio-Terminal-to-Google-Cloud" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en-US">English</a></li><li><a href="/docusaurus_wiki/zh-CN/Sensor/SenseCAP_the_Sensor_Prototype_Kit/WiFi Uplink/Connect-Wio-Terminal-to-Google-Cloud" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-CN">中文（中国）</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link navbar_doc_items">Page</a><ul class="dropdown__menu"><li><a class="dropdown__link" target="_blank" href="/docusaurus_wiki/indexIAG">SenseCAP</a></li><li><a class="dropdown__link" target="_blank" href="/docusaurus_wiki/./">Initial</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Connect Wio Terminal to Google Cloud IoT Core</h1><p style="text-align:center"><img loading="lazy" src="https://files.seeedstudio.com/wiki/Google_Cloud_IoT/thumb.png" alt="pir" width="600" height="auto" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="upgradable-to-industrial-sensors">Upgradable to Industrial Sensors<a class="hash-link" href="#upgradable-to-industrial-sensors" title="Direct link to heading">​</a></h2><p>With the SenseCAP <a href="https://www.seeedstudio.com/SenseCAP-XIAO-LoRaWAN-Controller-p-5474.html" target="_blank" rel="noopener noreferrer">S2110 controller</a> and <a href="https://www.seeedstudio.com/SenseCAP-S2100-LoRaWAN-Data-Logger-p-5361.html" target="_blank" rel="noopener noreferrer">S2100 data logger</a>, you can easily turn the Grove into a LoRaWAN® sensor. Seeed not only helps you with prototyping but also offers you the possibility to expand your project with the SenseCAP series of robust <a href="https://www.seeedstudio.com/catalogsearch/result/?q=sensecap&amp;categories=SenseCAP&amp;application=Temperature%2FHumidity~Soil~Gas~Light~Weather~Water~Automation~Positioning~Machine%20Learning~Voice%20Recognition&amp;compatibility=SenseCAP" target="_blank" rel="noopener noreferrer">industrial sensors</a>.</p><p>The IP66 housing, Bluetooth configuration, compatibility with the global LoRaWAN® network, built-in 19 Ah battery, and powerful support from APP make the <a href="https://www.seeedstudio.com/catalogsearch/result/?q=S21&amp;categories=SenseCAP~LoRaWAN%20Device&amp;product_module=Device" target="_blank" rel="noopener noreferrer">SenseCAP S210x</a> the best choice for industrial applications. The series includes sensors for soil moisture, air temperature and humidity, light intensity, CO2, EC, and an 8-in-1 weather station. Try the latest SenseCAP S210x for your next successful industrial project.</p><table style="margin-left:auto;margin-right:auto"><tbody><tr><td colspan="4" bgcolor="#0e3c49" align="center"><font color="white" size="4"><strong>SenseCAP Industrial Sensor</strong></font></td></tr><tr><td bgcolor="#0e3c49"><a href="https://www.seeedstudio.com/SenseCAP-S2100-LoRaWAN-Data-Logger-p-5361.html" target="_blank" rel="noopener noreferrer"></a><div align="center"><a href="https://www.seeedstudio.com/SenseCAP-S2100-LoRaWAN-Data-Logger-p-5361.html" target="_blank" rel="noopener noreferrer"><img loading="lazy" width="100%" src="https://files.seeedstudio.com/wiki/K1100_overview/2/S2100.png" class="img_ev3q"></a></div></td><td bgcolor="#0e3c49"><a href="https://www.seeedstudio.com/SenseCAP-S2101-LoRaWAN-Air-Temperature-and-Humidity-Sensor-p-5354.html" target="_blank" rel="noopener noreferrer"></a><div align="center"><a href="https://www.seeedstudio.com/SenseCAP-S2101-LoRaWAN-Air-Temperature-and-Humidity-Sensor-p-5354.html" target="_blank" rel="noopener noreferrer"><img loading="lazy" width="100%" src="https://files.seeedstudio.com/wiki/K1100_overview/2/S2101&amp;S2103.png" class="img_ev3q"></a></div></td><td bgcolor="#0e3c49"><a href="https://www.seeedstudio.com/SenseCAP-S2102-LoRaWAN-Light-Intensity-Sensor-p-5355.html" target="_blank" rel="noopener noreferrer"></a><div align="center"><a href="https://www.seeedstudio.com/SenseCAP-S2102-LoRaWAN-Light-Intensity-Sensor-p-5355.html" target="_blank" rel="noopener noreferrer"><img loading="lazy" width="100%" src="https://files.seeedstudio.com/wiki/K1100_overview/2/S2102.png" class="img_ev3q"></a></div></td><td bgcolor="#0e3c49"><a href="https://www.seeedstudio.com/SenseCAP-S2103-LoRaWAN-CO2-Temperature-and-Humidity-Sensor-p-5356.html" target="_blank" rel="noopener noreferrer"></a><div align="center"><a href="https://www.seeedstudio.com/SenseCAP-S2103-LoRaWAN-CO2-Temperature-and-Humidity-Sensor-p-5356.html" target="_blank" rel="noopener noreferrer"><img loading="lazy" width="100%" src="https://files.seeedstudio.com/wiki/K1100_overview/2/S2101&amp;S2103.png" class="img_ev3q"></a></div></td></tr><tr><td bgcolor="#0e3c49" align="center"><a href="https://www.seeedstudio.com/SenseCAP-S2100-LoRaWAN-Data-Logger-p-5361.html" target="_blank" rel="noopener noreferrer"><strong>S2100 <br> Data Logger</strong></a></td><td bgcolor="#0e3c49" align="center"><a href="https://www.seeedstudio.com/SenseCAP-S2101-LoRaWAN-Air-Temperature-and-Humidity-Sensor-p-5354.html" target="_blank" rel="noopener noreferrer"><strong>S2101 <br> Air Temp &amp; Humidity</strong></a></td><td bgcolor="#0e3c49" align="center"><a href="https://www.seeedstudio.com/SenseCAP-S2102-LoRaWAN-Light-Intensity-Sensor-p-5355.html" target="_blank" rel="noopener noreferrer"><strong>S2102 <br> Light</strong></a></td><td bgcolor="#0e3c49" align="center"><a href="https://www.seeedstudio.com/SenseCAP-S2103-LoRaWAN-CO2-Temperature-and-Humidity-Sensor-p-5356.html" target="_blank" rel="noopener noreferrer"><strong>S2103 <br> Air Temp &amp; Humidity &amp; CO2</strong></a></td></tr><tr><td bgcolor="#0e3c49"><a href="https://www.seeedstudio.com/SenseCAP-S2104-LoRaWAN-Soil-Temperature-and-Moisture-Sensor-p-5357.html" target="_blank" rel="noopener noreferrer"></a><div align="center"><a href="https://www.seeedstudio.com/SenseCAP-S2104-LoRaWAN-Soil-Temperature-and-Moisture-Sensor-p-5357.html" target="_blank" rel="noopener noreferrer"><img loading="lazy" width="100%" src="https://files.seeedstudio.com/wiki/K1100_overview/2/S2104.png" class="img_ev3q"></a></div></td><td bgcolor="#0e3c49"><a href="https://www.seeedstudio.com/SenseCAP-S2105-LoRaWAN-Soil-Temperature-Moisture-and-EC-Sensor-p-5358.html" target="_blank" rel="noopener noreferrer"></a><div align="center"><a href="https://www.seeedstudio.com/SenseCAP-S2105-LoRaWAN-Soil-Temperature-Moisture-and-EC-Sensor-p-5358.html" target="_blank" rel="noopener noreferrer"><img loading="lazy" width="100%" src="https://files.seeedstudio.com/wiki/K1100_overview/2/S2105.png" class="img_ev3q"></a></div></td><td bgcolor="#0e3c49"><a href="https://www.seeedstudio.com/SenseCAP-XIAO-LoRaWAN-Controller-p-5474.html" target="_blank" rel="noopener noreferrer"></a><div align="center"><a href="https://www.seeedstudio.com/SenseCAP-XIAO-LoRaWAN-Controller-p-5474.html" target="_blank" rel="noopener noreferrer"><img loading="lazy" width="100%" src="https://files.seeedstudio.com/wiki/K1100_overview/2/S2110.png" class="img_ev3q"></a></div></td><td bgcolor="#0e3c49"><a href="https://www.seeedstudio.com/sensecap-s2120-lorawan-8-in-1-weather-sensor-p-5436.html" target="_blank" rel="noopener noreferrer"></a><div align="center"><a href="https://www.seeedstudio.com/sensecap-s2120-lorawan-8-in-1-weather-sensor-p-5436.html" target="_blank" rel="noopener noreferrer"><img loading="lazy" width="100%" src="https://files.seeedstudio.com/wiki/K1100_overview/2/S2120.png" class="img_ev3q"></a></div></td></tr><tr><td bgcolor="#0e3c49" align="center"><a href="https://www.seeedstudio.com/SenseCAP-S2104-LoRaWAN-Soil-Temperature-and-Moisture-Sensor-p-5357.html" target="_blank" rel="noopener noreferrer"><strong>S2104 <br> Soil Moisture &amp; Temp</strong></a></td><td bgcolor="#0e3c49" align="center"><a href="https://www.seeedstudio.com/SenseCAP-S2105-LoRaWAN-Soil-Temperature-Moisture-and-EC-Sensor-p-5358.html" target="_blank" rel="noopener noreferrer"><strong>S2105 <br> Soil Moisture &amp; Temp &amp; EC</strong></a></td><td bgcolor="#0e3c49" align="center"><a href="https://www.seeedstudio.com/SenseCAP-XIAO-LoRaWAN-Controller-p-5474.html" target="_blank" rel="noopener noreferrer"><strong>S2110 <br> LoRaWAN® Controller</strong></a></td><td bgcolor="#0e3c49" align="center"><a href="https://www.seeedstudio.com/sensecap-s2120-lorawan-8-in-1-weather-sensor-p-5436.html" target="_blank" rel="noopener noreferrer"><strong>S2120 <br> 8-in-1 Weather Station</strong></a></td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">​</a></h2><p>In this tutorial, we will walk you through the process of connecting the Wio Terminal to Google Cloud IoT Core and send telemetry data from the Wio Terminal to the Google Cloud IoT core. This will be divided into two sections where the first section will talk about how to use the exciting libraries to send telemetry data preconfigured in the code, whereas the second section will talk about how to add your own sensors to the Wio Terminal to send the telemetry data to Google Cloud IoT Core. Google Cloud IoT Core supports both HTTP and MQTT protocols for communication, but however we will be using the MQTT protocol in this tutorial.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-google-cloud">What is Google Cloud?<a class="hash-link" href="#what-is-google-cloud" title="Direct link to heading">​</a></h3><p><a href="https://cloud.google.com/" target="_blank" rel="noopener noreferrer">Google Cloud</a> consists of a set of physical assets, such as computers and hard disk drives, and virtual resources, such as virtual machines (VMs), that are contained in Google&#x27;s data centers around the globe. This distribution of resources provides several benefits, including redundancy in case of failure and reduced latency by locating resources closer to clients.</p><p>In cloud computing, what you might be used to thinking of as software and hardware products, become services. These services provide access to the underlying resources. The <a href="https://cloud.google.com/products" target="_blank" rel="noopener noreferrer">list of available Google Cloud services</a> is long, and it keeps growing. When you develop your website or application on Google Cloud, you mix and match these services into combinations that provide the infrastructure you need, and then add your code to enable the scenarios you want to build.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-google-cloud-platform">What is Google Cloud Platform?<a class="hash-link" href="#what-is-google-cloud-platform" title="Direct link to heading">​</a></h3><p><a href="https://console.cloud.google.com/" target="_blank" rel="noopener noreferrer">Google Cloud Platform (GCP)</a> is a collection of cloud computing services. With a set of management tools, it provides a series of modular cloud services including computing, data storage, data analytics and machine learning. It provides infrastructure as a service, platform as a service, and serverless computing environments.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-google-cloud-iot-core">What is Google Cloud IoT Core?<a class="hash-link" href="#what-is-google-cloud-iot-core" title="Direct link to heading">​</a></h3><p><a href="https://cloud.google.com/iot/docs" target="_blank" rel="noopener noreferrer">Google Cloud Internet of Things (IoT) Core</a> is a fully managed service for securely connecting and managing IoT devices, from a few to millions. Ingest data from connected devices and build rich applications that integrate with the other big data services of Google Cloud Platform.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-google-cloud-console">What is Google Cloud Console?<a class="hash-link" href="#what-is-google-cloud-console" title="Direct link to heading">​</a></h3><p><a href="https://console.cloud.google.com/" target="_blank" rel="noopener noreferrer">Google Cloud Console</a> provides a web-based, graphical user interface that you can use to manage Google Cloud Platform resources. When you use the Cloud Console, you create a new project, or choose an existing project, and use the resources that you create in the context of that project. You can create multiple projects, so you can use projects to separate your work in whatever way makes sense for you. For example, you might start a new project if you want to make sure only certain team members can access the resources in that project, while all team members can continue to access resources in another project.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="connecting-wio-terminal-to-google-cloud-iot-core-via-mqtt">Connecting Wio Terminal to Google Cloud IoT Core via MQTT<a class="hash-link" href="#connecting-wio-terminal-to-google-cloud-iot-core-via-mqtt" title="Direct link to heading">​</a></h2><p>As explained before, we will be using the availble MQTT bridge for the communication between the Wio Terminal and the Google Cloud IoT Core. However, you may use the HTTP bridge as well, if that is your requirement.</p><p style="text-align:center"><img loading="lazy" src="https://files.seeedstudio.com/wiki/Google_Cloud_IoT/5555555.png" alt="pir" width="600" height="auto" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="google-cloud-console-set-up">Google Cloud Console Set Up<a class="hash-link" href="#google-cloud-console-set-up" title="Direct link to heading">​</a></h3><p>First we need to visit the Google Cloud Console, create a Cloud IoT Core device registry and register a device.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="intial-setup">Intial Setup<a class="hash-link" href="#intial-setup" title="Direct link to heading">​</a></h4><ul><li><strong>STEP 1:</strong> Visit <a href="https://console.cloud.google.com/" target="_blank" rel="noopener noreferrer">here</a> to create a new project</li></ul><p><strong>Note:</strong> Log in to your Google account if prompted</p><ul><li><p><strong>STEP 2:</strong> Click <strong>Select a project</strong> menu</p></li><li><p><strong>STEP 3:</strong> Click <strong>NEW PROJECT</strong> and enter a <strong>project name</strong></p></li><li><p><strong>STEP 4:</strong> Click <strong>CREATE</strong> </p></li><li><p><strong>STEP 5:</strong> Enable billing for your Cloud project. This is required to make sure you are not a robot and you will not be charged. Choose &quot;Billing&quot; under the navigation menu and go through the set up.</p></li></ul><p style="text-align:center"><img loading="lazy" src="https://files.seeedstudio.com/wiki/Google_Cloud_IoT/1111111.png" alt="pir" width="500" height="auto" class="img_ev3q"></p><ul><li><strong>STEP 6:</strong> Visit <a href="https://console.cloud.google.com/flows/enableapi?apiid=cloudiot.googleapis.com%2Cpubsub&amp;authuser=3&amp;_ga=2.254170561.853675115.1607885458-878786893.1606048800" target="_blank" rel="noopener noreferrer">here</a> to enable the Cloud IoT Core and Cloud Pub/Sub APIs</li></ul><p><strong>Note:</strong> Choose the project that you created before from the drop-down menu</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-device-registry">Create a Device Registry<a class="hash-link" href="#create-a-device-registry" title="Direct link to heading">​</a></h4><ul><li><p><strong>STEP 1:</strong> Visit <a href="https://console.cloud.google.com/iot/registries" target="_blank" rel="noopener noreferrer">Google Cloud IoT Core page</a> in Cloud Console</p></li><li><p><strong>STEP 2:</strong> Click <strong>Create Registry</strong></p></li><li><p><strong>STEP 3:</strong> Enter a <strong>registry ID</strong></p></li></ul><p><strong>Note:</strong> This is the name of your registry</p><ul><li><strong>STEP 4:</strong> Select a <strong>Region</strong></li></ul><p><strong>Note:</strong> If you&#x27;re in the US, select us-central1 for the Region. If you&#x27;re outside the US, select your preferred region.</p><ul><li><p><strong>STEP 5:</strong> In the <strong>Select a Cloud Pub/Sub topic</strong> dropdown list, select <strong>Create a topic</strong> and type your preferred <strong>Topic ID</strong></p></li><li><p><strong>STEP 6:</strong> Click <strong>CREATE TOPIC</strong></p></li><li><p><strong>STEP 7:</strong> Click on <strong>SHOW ADVANCED OPTIONS</strong></p></li><li><p><strong>STEP 8:</strong> The <strong>Device state topic</strong> and <strong>Certificate value</strong> fields are optional, so leave them blank</p></li><li><p><strong>STEP 9:</strong> Select <strong>MQTT</strong> for the <strong>Protocol</strong></p></li><li><p><strong>STEP 10:</strong> Click <strong>Create</strong> on the Cloud IoT Core page</p></li></ul><p>Now we have created a device registry with a Cloud Pub/Sub topic for publishing device telemetry events</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="generate-a-device-key-pair-ec-keys">Generate a Device Key Pair (EC Keys)<a class="hash-link" href="#generate-a-device-key-pair-ec-keys" title="Direct link to heading">​</a></h4><p>Cloud IoT Core uses public key (or asymmetric) authentication</p><ul><li>The device uses a private key to sign a <a href="https://cloud.google.com/iot/docs/how-tos/credentials/jwts" target="_blank" rel="noopener noreferrer">JSON Web Token (JWT)</a>. The token is passed to Cloud IoT Core as proof of the device&#x27;s identity. </li><li>The service uses the device public key (uploaded before the JWT is sent) to verify the device&#x27;s identity.</li></ul><p>Cloud IoT Core supports the RSA and Elliptic Curve algorithms, and we will be using Elliptic Curve keys in this tutorial.</p><ul><li><p><strong>STEP 1:</strong> Create a new folder on your PC</p></li><li><p><strong>STEP 2:</strong> Navigate to the folder from a terminal window and type the following to generate a P-256 Elliptic Curve key pair</p></li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl ecparam -genkey -name prime256v1 -noout -out ec_private.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl ec -in ec_private.pem -pubout -out ec_public.pem</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Note:</strong> Make sure to install <strong>openssl</strong> by following <a href="https://slproweb.com/products/Win32OpenSSL.html" target="_blank" rel="noopener noreferrer">this link</a> and adding the directory location to PATH.</p><p>The above commands create the following public/private key pair:</p><ul><li><strong>ec_private.pem</strong>: The private key that must be securely stored on the device and used to sign the authentication JWT.</li><li><strong>ec_public.pem</strong>: The public key that must be stored in Cloud IoT Core and used to verify the signature of the authentication JWT.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="extract-the-private-key">Extract the Private Key<a class="hash-link" href="#extract-the-private-key" title="Direct link to heading">​</a></h4><p>We need to extract the private key bytes and copy them into  the private key string in the Arduino project that we will create later in this tutorial. Save these keys for now to use later.</p><ul><li><p><strong>STEP 1:</strong> Open a terminal window and navigate to the folder containing the Elliptic Curve key pair that we generated before. </p></li><li><p><strong>STEP 2:</strong> Type the following command</p></li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl ec -in ec_private.pem -noout -text</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>STEP 3:</strong> Copy and paste the generated private key bytes under <strong>priv:</strong> into a notepad and save for later use.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="add-a-device-to-the-registry">Add a Device to the Registry<a class="hash-link" href="#add-a-device-to-the-registry" title="Direct link to heading">​</a></h4><ul><li><p><strong>STEP 1:</strong> Visit the <a href="https://console.cloud.google.com/iot/registries" target="_blank" rel="noopener noreferrer">Registries page</a> and select the registry that you created before</p></li><li><p><strong>STEP 2:</strong> Select the <strong>Devices</strong> tab and click <strong>CREATE A DEVICE</strong></p></li><li><p><strong>STEP 3:</strong> Enter a <strong>Device ID</strong></p></li><li><p><strong>STEP 4:</strong> The <strong>Device metadata</strong> field is optional, so leave it blank</p></li><li><p><strong>STEP 5:</strong> Click on the <strong>COMMUNICATION, CLOUD LOGGING, AUTHENTICATION</strong> drop-down menu</p></li><li><p><strong>STEP 6:</strong> Select <strong>Allow</strong> for <strong>Device communication</strong></p></li><li><p><strong>STEP 7:</strong> Inside the <strong>Authentication</strong> field, under <strong>Input method</strong>, select <strong>Upload</strong></p></li><li><p><strong>STEP 8:</strong> Select <strong>ES256</strong> from the <strong>Public key format</strong> drop-down menu</p></li><li><p><strong>STEP 9:</strong> Under <strong>Public key value</strong>, press the <strong>BROWSE</strong> button ,navigate to the <strong>Elliptic Curve key pair</strong> folder that we created before and select <strong>ec_public.pem</strong></p></li><li><p><strong>STEP 10:</strong> Click <strong>Create</strong></p></li></ul><p>You have now added a device to your registry. The ES256 key appears on the Device details page for your device.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="set-up-a-subscriber">Set up a Subscriber<a class="hash-link" href="#set-up-a-subscriber" title="Direct link to heading">​</a></h4><p>Now that we have created a device registry, created a topic and added a device to that registry, let&#x27;s move on to creating a subscriber to subcribe to the topic we have created, in order to grab the telemetry data from the Wio Terminal.</p><ul><li><strong>STEP 1:</strong> Type <strong>Pub</strong> on the search bar of Google Cloud Console and select <strong>Pub/Sub</strong> from the results</li></ul><p style="text-align:center"><img loading="lazy" src="https://files.seeedstudio.com/wiki/Google_Cloud_IoT/333333.png" alt="pir" width="700" height="auto" class="img_ev3q"></p><ul><li><p><strong>STEP 2:</strong> Click <strong>Subscriptions</strong> on the navigation menu</p></li><li><p><strong>STEP 3:</strong> Click <strong>CREATE SUBSCRIPTION</strong> </p></li><li><p><strong>STEP 4:</strong> Enter a <strong>Subscription ID</strong> of your choice</p></li><li><p><strong>STEP 5:</strong> Select the <strong>Pub/Sub topic</strong> that we previously created from the <strong>Select a Cloud Pub/Sub topic</strong> drop-down menu</p></li><li><p><strong>STEP 6:</strong> Select <strong>Pull</strong> as the Delivery type</p></li><li><p><strong>STEP 7:</strong> Click <strong>Create</strong> </p></li></ul><p>Now we have finished setting up the Google Cloud IoT Core. Next, we will move on to setting up the Wio Terminal along with the Arduino IDE.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="arduino-set-up-with-wio-terminal">Arduino Set Up with Wio Terminal<a class="hash-link" href="#arduino-set-up-with-wio-terminal" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="needed-libraries">Needed Libraries<a class="hash-link" href="#needed-libraries" title="Direct link to heading">​</a></h4><p>We need two libraries for this tutorial. </p><ol><li>lwMQTT MQTT Arduino Library</li><li>Google Cloud IoT Arduino Library</li></ol><p>To download these libaries:</p><ul><li><strong>STEP 1:</strong> Open Arduino IDE</li><li><strong>STEP 2:</strong> Navigate to <code>Sketch &gt; Include Library &gt; Manage Libraries</code></li><li><strong>STEP 3:</strong> Type <strong>lwMQTT</strong> and <strong>Google Cloud IoT</strong> in the search box and install the libraries</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="credentials-and-account-information-configuration">Credentials and Account Information Configuration<a class="hash-link" href="#credentials-and-account-information-configuration" title="Direct link to heading">​</a></h4><p>Now we need to set the Wi-Fi credentials and Google Cloud IoT Core information in the <strong>ciotc_config.h</strong> file.</p><ul><li><p><strong>STEP 1:</strong> Inside Arduino IDE, <code>File &gt; Examples &gt; Google Cloud IoT JWT &gt; Esp32-lwmqtt</code></p></li><li><p><strong>STEP 2:</strong> Navigate to <strong>ciotc_config.h</strong></p></li><li><p><strong>STEP 3:</strong> Change the <strong>Wifi network details</strong></p></li></ul><div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">const char *ssid = &quot;Enter_SSID&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const char *password = &quot;Enter_Password&quot;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>STEP 4:</strong> Change the <strong>Google Cloud IoT details</strong></li></ul><div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">const char *project_id = &quot;Enter_Project_ID&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const char *location = &quot;Enter_location&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const char *registry_id = &quot;Enter_Registry_ID&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const char *device_id = &quot;Enter_Device_ID&quot;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>STEP 5:</strong> Copy the private key bytes that we obtained from <strong>ec_private.pem</strong> and saved into notepad before</li></ul><div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">const char *private_key_str =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;6e:b8:17:35:c7:fc:6b:d7:a9:cb:cb:49:7f:a0:67:&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;63:38:b0:90:57:57:e0:c0:9a:e8:6f:06:0c:d9:ee:&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;31:41&quot;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Note:</strong> The key length should be 32 pairs of hex digits</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="change-ntp-time-methods">Change NTP Time Methods<a class="hash-link" href="#change-ntp-time-methods" title="Direct link to heading">​</a></h4><p>Open <strong>esp32-mqtt.h</strong> and replace the entire file with the following codes. Here we have replaced configTime function with the implementation of obtaining NTP time via UDP.</p><div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;Client.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;rpcWiFi.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;WiFiClientSecure.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;MQTT.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;CloudIoTCore.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;CloudIoTCoreMqtt.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;ciotc_config.h&quot; // Update this file with your configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// !!REPLACEME!!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// The MQTT callback function for commands and configuration updates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Place your message handler code here.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void messageReceived(String &amp;topic, String &amp;payload){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Serial.println(&quot;incoming: &quot; + topic + &quot; - &quot; + payload);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">///////////////////////////////</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Initialize WiFi and MQTT for this board</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//Client *netClient;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CloudIoTCoreDevice *device;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CloudIoTCoreMqtt *mqtt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MQTTClient *mqttClient;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unsigned long iat = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">String jwt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WiFiUDP udp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unsigned int localPort = 2390;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unsigned long devicetime;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const int NTP_PACKET_SIZE = 48; // NTP time stamp is in the first 48 bytes of the message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">byte packetBuffer[NTP_PACKET_SIZE]; //buffer to hold incoming and outgoing packets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// send an NTP request to the time server at the given address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unsigned long sendNTPpacket(const char* address) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // set all bytes in the buffer to 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (int i = 0; i &lt; NTP_PACKET_SIZE; ++i) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        packetBuffer[i] = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Initialize values needed to form NTP request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // (see URL above for details on the packets)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    packetBuffer[0] = 0b11100011;   // LI, Version, Mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    packetBuffer[1] = 0;     // Stratum, or type of clock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    packetBuffer[2] = 6;     // Polling Interval</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    packetBuffer[3] = 0xEC;  // Peer Clock Precision</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 8 bytes of zero for Root Delay &amp; Root Dispersion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    packetBuffer[12] = 49;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    packetBuffer[13] = 0x4E;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    packetBuffer[14] = 49;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    packetBuffer[15] = 52;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // all NTP fields have been given values, now</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // you can send a packet requesting a timestamp:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    udp.beginPacket(address, 123); //NTP requests are to port 123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    udp.write(packetBuffer, NTP_PACKET_SIZE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    udp.endPacket();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unsigned long getNTPtime() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // module returns a unsigned long time valus as secs since Jan 1, 1970 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // unix time or 0 if a problem encounted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //only send data when connected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (WiFi.status() == WL_CONNECTED) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //initializes the UDP state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //This initializes the transfer buffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        udp.begin(WiFi.localIP(), localPort);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sendNTPpacket(ntp_primary); // send an NTP packet to a time server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // wait to see if a reply is available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        delay(1000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (udp.parsePacket()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            Serial.println(&quot;udp packet received&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            Serial.println(&quot;&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // We&#x27;ve received a packet, read the data from it</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            udp.read(packetBuffer, NTP_PACKET_SIZE); // read the packet into the buffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //the timestamp starts at byte 40 of the received packet and is four bytes,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // or two words, long. First, extract the two words:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            unsigned long highWord = word(packetBuffer[40], packetBuffer[41]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            unsigned long lowWord = word(packetBuffer[42], packetBuffer[43]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // combine the four bytes (two words) into a long integer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // this is NTP time (seconds since Jan 1 1900):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            unsigned long secsSince1900 = highWord &lt;&lt; 16 | lowWord;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Unix time starts on Jan 1 1970. In seconds, that&#x27;s 2208988800:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            const unsigned long seventyYears = 2208988800UL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // subtract seventy years:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            unsigned long epoch = secsSince1900 - seventyYears;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // adjust time for timezone offset in secs +/- from UTC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // WA time offset from UTC is +8 hours (28,800 secs)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // + East of GMT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // - West of GMT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            long tzOffset = 28800UL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            long tzOffset = 0UL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // WA local time </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            unsigned long adjustedTime;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return adjustedTime = epoch + tzOffset;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // were not able to parse the udp packet successfully</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // clear down the udp connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            udp.stop();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return 0; // zero indicates a failure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // not calling ntp time frequently, stop releases resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        udp.stop();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // network not connected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">///////////////////////////////</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Helpers specific to this board</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">///////////////////////////////</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">String getDefaultSensor(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return &quot;Wifi: &quot; + String(WiFi.RSSI()) + &quot;db&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">String getJwt(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Serial.println(&quot;Refreshing JWT&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  iat = getNTPtime();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Serial.println(iat);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  jwt = device-&gt;createJWT(iat, jwt_exp_secs);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Serial.println(jwt);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return jwt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void setupWifi(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Serial.println(&quot;Starting wifi&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  WiFi.mode(WIFI_STA);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // WiFi.setSleep(false); // May help with disconnect? Seems to have been removed from WiFi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  WiFi.begin(ssid, password);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Serial.println(&quot;Connecting to WiFi&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  while (WiFi.status() != WL_CONNECTED){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    delay(100);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//  configTime(0, 0, ntp_primary, ntp_secondary);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Serial.println(&quot;Waiting on time sync...&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//  Serial.println(getNTPtime());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  while (getNTPtime() &lt; 1510644967){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    delay(10);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void connectWifi(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Serial.print(&quot;checking wifi...&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  while (WiFi.status() != WL_CONNECTED){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Serial.print(&quot;.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    delay(1000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">///////////////////////////////</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Orchestrates various methods from preceeding code.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">///////////////////////////////</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bool publishTelemetry(String data){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return mqtt-&gt;publishTelemetry(data);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bool publishTelemetry(const char *data, int length){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return mqtt-&gt;publishTelemetry(data, length);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bool publishTelemetry(String subfolder, String data){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return mqtt-&gt;publishTelemetry(subfolder, data);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bool publishTelemetry(String subfolder, const char *data, int length){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return mqtt-&gt;publishTelemetry(subfolder, data, length);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void connect(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  connectWifi();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mqtt-&gt;mqttConnect();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WiFiClientSecure netClient;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void setupCloudIoT(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  device = new CloudIoTCoreDevice(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      project_id, location, registry_id, device_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      private_key_str);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  setupWifi();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//  netClient = new WiFiClientSecure();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mqttClient = new MQTTClient(512);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mqttClient-&gt;setOptions(180, true, 1000); // keepAlive, cleanSession, timeout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mqtt = new CloudIoTCoreMqtt(mqttClient, &amp;netClient, device);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mqtt-&gt;setUseLts(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mqtt-&gt;startMQTT();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="add-macro-definition-to-esp32-lwmqttino">Add Macro Definition to Esp32-lwmqtt.ino<a class="hash-link" href="#add-macro-definition-to-esp32-lwmqttino" title="Direct link to heading">​</a></h4><p>Add Wio Terminal board to macro definitions inside <strong>Esp32-lwmqtt.ino</strong></p><div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#if defined(ESP32) || defined(WIO_TERMINAL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define __ESP32_MQTT_H__</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#endif</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now we have finished setting up Arduino IDE. Finally you need to Upload this code to Wio Terminal. Open Serial Monitor and you will see the following displayed.</p><p style="text-align:center"><img loading="lazy" src="https://files.seeedstudio.com/wiki/Google_Cloud_IoT/4444444.png" alt="pir" width="700" height="auto" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="display-telemetry-data">Display Telemetry Data<a class="hash-link" href="#display-telemetry-data" title="Direct link to heading">​</a></h3><p>Now we need to display the incoming telemetry data from the Wio Terminal. Here in this example code, the Wi-Fi signal strength will be sent as telemetry data.</p><ul><li><strong>STEP 1:</strong> Visit <strong>Pub/Sub</strong> in Google Cloud Console</li></ul><p><strong>Note:</strong> You can search <strong>Pub</strong> in the search bar within Google Cloud Console</p><ul><li><p><strong>STEP 2:</strong> Navigate to <strong>Subscriptions</strong> inside Navigation Menu</p></li><li><p><strong>STEP 3:</strong> Select the subscription ID that we created before</p></li><li><p><strong>STEP 4:</strong> Click on <strong>VIEW MESSAGES</strong></p></li><li><p><strong>STEP 5:</strong> Click on <strong>PULL</strong> and you will see the incoming telemetry data as follows.</p></li></ul><p style="text-align:center"><img loading="lazy" src="https://files.seeedstudio.com/wiki/Google_Cloud_IoT/6666666.png" alt="pir" width="950" height="auto" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-add-other-sensors">How to Add Other Sensors?<a class="hash-link" href="#how-to-add-other-sensors" title="Direct link to heading">​</a></h3><p>You can add any sensor to the Wio Terminal and send telemetry data to Google Cloud IoT Core. For simplicity, we will use the built-in light sensor on the Wio Terminal to send light intensity levels to Google Cloud IoT Core.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="google-cloud-iot-set-up">Google Cloud IoT Set Up<a class="hash-link" href="#google-cloud-iot-set-up" title="Direct link to heading">​</a></h4><ul><li><strong>STEP 1:</strong> Visit <strong>IoT Core</strong> in Google Cloud Console</li></ul><p><strong>Note:</strong> You can search <strong>IoT Core</strong> in the search bar within Google Cloud Console</p><ul><li><p><strong>STEP 2:</strong> Select the registry that we created before </p></li><li><p><strong>STEP 3:</strong> Under Cloud <strong>Pub/Sub topics</strong> select <strong>Add or edit topics</strong></p></li><li><p><strong>STEP 4:</strong> Click <strong>ADD ADDITIONAL TOPIC</strong></p></li><li><p><strong>STEP 5:</strong> Click <strong>CREATE A TOPIC</strong> from the drop-down menu of <strong>Select a Cloud Pub/Sub topic</strong></p></li><li><p><strong>STEP 6:</strong> Enter a <strong>Topic ID</strong> and click <strong>CREATE TOPIC</strong></p></li><li><p><strong>STEP 7:</strong> Enter a <strong>Subfolder name</strong> inside the <strong>Subfolder</strong> column</p></li></ul><p><strong>Note:</strong> Subfolder name will be used to relate to the topic in the Arduino code</p><ul><li><p><strong>STEP 8:</strong> Click <strong>UPDATE</strong></p></li><li><p><strong>STEP 9:</strong> Create a <strong>new subscription</strong> as explained before</p></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="arduino-set-up">Arduino Set Up<a class="hash-link" href="#arduino-set-up" title="Direct link to heading">​</a></h4><p>Navigate to <strong>Esp32-lwmqtt.ino</strong> and add the following</p><ul><li><strong>STEP 1:</strong>  After the loop, add the following for the built-in light sensor</li></ul><div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void loop() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int light = analogRead(WIO_LIGHT); //assign variable to store light sensor values </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  light = map(light,0,1023,0,100); //Map sensor values  </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>STEP 2:</strong>  Add the topic with the Subfolder name </li></ul><div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    publishTelemetry(getDefaultSensor());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    publishTelemetry(&quot;/light&quot;,String(light));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Note:</strong> If a subfolder name is not added, telemetry data will be sent to the default topic. In this case, the telemetry data for Wi-Fi signal strength as explained before will be sent to the first topic that we crated before which is the default topic.</p><p>After you upload the code to the Wio Terminal, pull from the newly created topic as a subscriber and you will see the following result.</p><p style="text-align:center"><img loading="lazy" src="https://files.seeedstudio.com/wiki/Google_Cloud_IoT/222222.png" alt="pir" width="950" height="auto" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-add-other-sensors-and-visualize-data-on-dashboards">How to Add Other Sensors And Visualize Data on Dashboards?<a class="hash-link" href="#how-to-add-other-sensors-and-visualize-data-on-dashboards" title="Direct link to heading">​</a></h3><p>Eventhough Google Cloud IoT Core doesn&#x27;t offer a ready-to-use dashboard to visualize the data from sensors, we will explain how to achieve this by using InfluxDB and Grafana.</p><p><a href="https://www.influxdata.com/" target="_blank" rel="noopener noreferrer">InfluxDB</a> is a time series database,that is each data in InfluxDB is associated with a particular timestamp which shows date and time associated with a particular data. Whereas <a href="https://grafana.com/" target="_blank" rel="noopener noreferrer">Grafana</a> is an open source solution for running data analytics, pulling up metrics that make sense of the massive amount of data and to monitor apps with the help of customizable dashboards.</p><p>Basically, we will connect a temperature/ humidity sensor to the Wio Terminal, use a Google Cloud Function to transmit data from a Pub/Sub to a InfluxDB located in a GKE (Google Kubernetes Engine) cluster and display the data from InfluxDB on Grafana using interactive dashboards.</p><p style="text-align:center"><img loading="lazy" src="https://files.seeedstudio.com/wiki/Google_Cloud_IoT/thumb.png" alt="pir" width="600" height="auto" class="img_ev3q"></p>#### Hardware Set Up for Arduino<p>Connect the Grove - Temperature and Humudity Sensor (DHT11) to the Grove - Digital/Analog Port (D0) of the Wio Terminal.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="software-set-up-for-arduino">Software Set Up for Arduino<a class="hash-link" href="#software-set-up-for-arduino" title="Direct link to heading">​</a></h4><ul><li><p><strong>STEP 1:</strong> Visit the <a href="https://github.com/Seeed-Studio/Grove_Temperature_And_Humidity_Sensor" target="_blank" rel="noopener noreferrer">Grove - Temperature and Humidity Sensor repo</a> and download it as a zip file</p></li><li><p><strong>STEP 2:</strong> Open Arduino, navigate to <code>Sketch &gt; Include Library &gt; Add .ZIP Library</code> and select the downloaded library to install it</p></li></ul><p>Navigate to the previously used <strong>Esp32-lwmqtt.ino</strong> and add the following:</p><ul><li><strong>STEP 1:</strong> Add the following after <strong>#include &quot;esp32-mqtt.h&quot;</strong></li></ul><div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;DHT.h&quot; //DHT library</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define DHTPIN 0 //Define Signal Pin of DHT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define DHTTYPE DHT11 //Define DHT Sensor Type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DHT dht(DHTPIN, DHTTYPE); //Initializing DHT sensor  </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>STEP 2:</strong> Add the following inside the <strong>setup</strong> to start the DHT sensor</li></ul><div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dht.begin(); </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>STEP 3:</strong> Add the following inside the <strong>if loop</strong> within <strong>void loop()</strong></li></ul><div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">int temperature = dht.readTemperature(); //Assign variable to store temperature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int humidity = dht.readHumidity(); //Assign variable to store humidity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">String payload = String(&quot;{\&quot;timestamp\&quot;:&quot;) + getNTPtime() +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  String(&quot;,\&quot;temperature\&quot;:&quot;) temperature +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  String(&quot;,\&quot;humidity\&quot;:&quot;) + humidity +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  String(&quot;}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">publishTelemetry(payload); </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Note:</strong> Here we parse all the data as a string into influxDB. Parsing the <strong>time</strong> is important because influxDB is a time series database. Also the <strong>pushTelemetry</strong> function will send the data to the default topic we have created at the very beginning of this tutorial.</p><ul><li><strong>STEP 4:</strong> Upload the code to the Wio Terminal</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="google-cloud-iot-set-up-1">Google Cloud IoT Set Up<a class="hash-link" href="#google-cloud-iot-set-up-1" title="Direct link to heading">​</a></h4><ul><li><p><strong>STEP 1:</strong> Visit <a href="https://github.com/lakshanthad/esp32-cloud-iot-core-k8s" target="_blank" rel="noopener noreferrer">this</a> repo and download it as a zip file </p></li><li><p><strong>STEP 2:</strong> Extract the downloaded zip file </p></li><li><p><strong>STEP 3:</strong> Open Google Cloud Console and navigate to <a href="https://console.cloud.google.com/kubernetes/list" target="_blank" rel="noopener noreferrer">Google Kubernetes Engine</a> and wait for the system to initialize</p></li><li><p><strong>STEP 4:</strong> Start the Cloud shell by pressing the button on the top right corner </p></li></ul><p style="text-align:center"><img loading="lazy" src="https://files.seeedstudio.com/wiki/Google_Cloud_IoT/cloud_shell_1.png" alt="pir" width="700" height="auto" class="img_ev3q"></p><ul><li><strong>STEP 5:</strong> Type the following commands to set defaults for the gcloud command-line tool</li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export ZONE=&lt;enter_zone&gt; # e.g. us-central1-a, see https://cloud.google.com/compute/docs/regions-zones/#available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export PROJECT_ID=&lt;enter_project-id&gt; # project ID name </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud config set project $PROJECT_ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud config set compute/zone $ZONE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>STEP 6:</strong> Type the following commands to create a GKE cluster with one n1-standard-1 node</li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters create influxdb-grafana \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                --num-nodes 1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                --machine-type n1-standard-1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                --zone $ZONE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>STEP 7:</strong> Type the following commands to create a secret to store InfluxDB and Grafana auth information</li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create secret generic influxdb-grafana \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --from-literal=influxdb-user=admin \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --from-literal=influxdb-password=passw0rd \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --from-literal=grafana-user=admin \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --from-literal=grafana-password=passw0rd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Note:</strong> You can change influxdb/ grafana usernames and passwords according to your preference</p><ul><li><p><strong>STEP 8:</strong> Click on <strong>Open Editor</strong> within Google Shell</p></li><li><p><strong>STEP 9:</strong> Drag and drop the previously downloaded and extracted folder into <strong>Cloud Shell Editor</strong></p></li><li><p><strong>STEP 10:</strong> Click on <strong>Open Terminal</strong> to go back to terminal. Navigate to <strong>05-influxdb_grafana_k8s</strong> directory by typing the following</p></li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd esp32-cloud-iot-core-k8s-master/05-influxdb_grafana_k8s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>STEP 11:</strong> Type the following commands to deploy InfluxDB and Grafana to Kubernetes</li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create -f k8s/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="grafana-setup">Grafana Setup<a class="hash-link" href="#grafana-setup" title="Direct link to heading">​</a></h4><ul><li><strong>STEP 1:</strong> Type the following to check the services external IPs / ports</li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get services</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p><strong>STEP 2:</strong> Copy the external IP of Grafana</p></li><li><p><strong>STEP 3:</strong> Visit <code>http://&lt;grafana service external ip&gt;:3000</code></p></li></ul><p><strong>Note:</strong> Paste the previously copied Grafana external IP to <code>&lt;grafana service external ip&gt;</code></p><ul><li><p><strong>STEP 4:</strong> Log in to Grafana with the previously set credentials</p></li><li><p><strong>STEP 5:</strong> Click on the gear icon and navigate to <code>Configuration &gt; Data Sources</code></p></li><li><p><strong>STEP 6:</strong> Click <strong>Add data source</strong> and select <strong>influxDB</strong></p></li><li><p><strong>STEP 7:</strong> Enter the following into the <strong>URL</strong> field</p></li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">http://influxdb:8086</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>STEP 8:</strong> Enter the following in the <strong>Database</strong> field and click <strong>Save &amp; Test</strong></li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iot</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Note:</strong> You should see the message <strong>Data source is working</strong>, if you have sucessfully set up <strong>InfluxDB</strong> data source on Grafana</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-google-cloud-function">Create a Google Cloud Function<a class="hash-link" href="#create-a-google-cloud-function" title="Direct link to heading">​</a></h4><p>Now we need to create a Google Cloud Function to transmit data from a topic on Pub/Sub to InfluxDB and display the data from InfluxDB on Grafana using interactive dashboards.</p><ul><li><p><strong>STEP 1:</strong> Go back to <strong>Google Cloud Console</strong> and open the <strong>Cloud Shell</strong></p></li><li><p><strong>STEP 2:</strong> Type the following to enable <strong>Cloud Functions API</strong></p></li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud services enable cloudfunctions.googleapis.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>STEP 3:</strong> Navigate to <strong>06-cloud_function</strong> directory by typing the following</li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd esp32-cloud-iot-core-k8s-master/06-cloud_function</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>STEP 4:</strong> Open <strong>main.py</strong> in a <strong>vim text editor</strong></li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd esp32-cloud-iot-core-k8s-master/06-cloud_function</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p><strong>STEP 5:</strong> Press <strong>i</strong> on the keyboard to enter <strong>editing mode</strong></p></li><li><p><strong>STEP 6:</strong> modify <strong>InfluxDB variables</strong> (host, port, username, password) in the <strong>_get_influxdb_client function</strong></p></li></ul><p><strong>Note:</strong> Obtain the InfluxDB host by typing the following on Cloud Shell and copying the external IP </p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get services</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p><strong>STEP 7:</strong> Save the file by typing <strong>:wq</strong></p></li><li><p><strong>STEP 8:</strong> Deploy the <strong>Cloud Function</strong> by typing the following </p></li></ul><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export PUBSUB_TOPIC=&quot;enter_topic-name&gt;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export REGION=&quot;enter_region&quot; # https://cloud.google.com/functions/docs/locations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud functions deploy iotcore_pubsub_to_influxdb --runtime python37 --trigger-topic $PUBSUB_TOPIC --region $REGION</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="back-to-grafana-setup">Back to Grafana Setup<a class="hash-link" href="#back-to-grafana-setup" title="Direct link to heading">​</a></h4><ul><li><p><strong>STEP 1:</strong> Open Grafana and navigate to <code>Dashboards &gt; Manage</code></p></li><li><p><strong>STEP 2:</strong> Click <strong>New Dashboard</strong> and click <strong>Add new panel</strong></p></li><li><p><strong>STEP 3:</strong> Navigate to <strong>Visualization</strong> and click <strong>Graph</strong></p></li><li><p><strong>STEP 4:</strong> Under <strong>Query</strong>, in the <strong>FROM</strong> tab, click <strong>select measurement</strong> and select <strong>temperature</strong> from the drop-down menu</p></li><li><p><strong>STEP 5:</strong> Click <strong>+ Query</strong> and repeat the same step as <strong>step 12</strong> for <strong>humidity</strong></p></li><li><p><strong>STEP 6:</strong> Change the other settings according to your preference</p></li><li><p><strong>STEP 7:</strong> Click <strong>Apply</strong></p></li><li><p><strong>STEP 8:</strong> Click <strong>Add panel</strong> and <strong>Add new panel</strong></p></li><li><p><strong>STEP 9:</strong> Navigate to <strong>Visualization</strong> and click <strong>Gauge</strong></p></li><li><p><strong>STEP 10:</strong> Under <strong>Query</strong>, in the <strong>FROM</strong> tab, click <strong>select measurement</strong> and select <strong>temperature</strong> from the drop-down menu</p></li><li><p><strong>STEP 11:</strong> In <strong>Field</strong> tab, under <strong>Unit</strong>, select <code>Temperature &gt; Celcius</code> from the drop-down menu</p></li><li><p><strong>STEP 12:</strong> Set a minimum and maximum value for the gauge by typing in <strong>Min</strong> and <strong>Max</strong></p></li><li><p><strong>STEP 13:</strong> Under <strong>Display name</strong>, type <code>Temperature</code></p></li><li><p><strong>STEP 14:</strong> Repeat the same for <strong>humidity</strong> by following from <strong>step 15</strong>.</p></li><li><p><strong>STEP 15:</strong> Click <strong>Apply</strong></p></li></ul><p>You will now see the dashboard created on Grafana</p><p style="text-align:center"><img loading="lazy" src="https://files.seeedstudio.com/wiki/Google_Cloud_IoT/grafana_dash_1.png" alt="pir" width="900" height="auto" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tech-support">Tech Support<a class="hash-link" href="#tech-support" title="Direct link to heading">​</a></h2><p>Please submit any technical issue into our <a href="https://forum.seeedstudio.com/" target="_blank" rel="noopener noreferrer">forum</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/c1ev0ps/docusaurus_wiki/edit/main/docs/Sensor/SenseCAP_the_Sensor_Prototype_Kit/WiFi Uplink/Connect-Wio-Terminal-to-Google-Cloud.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-01-13T00:00:00.000Z">Jan 13, 2023</time></b> by <b>shuxu hu</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div><div>Loading Comments...</div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#upgradable-to-industrial-sensors" class="table-of-contents__link toc-highlight">Upgradable to Industrial Sensors</a></li><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a><ul><li><a href="#what-is-google-cloud" class="table-of-contents__link toc-highlight">What is Google Cloud?</a></li><li><a href="#what-is-google-cloud-platform" class="table-of-contents__link toc-highlight">What is Google Cloud Platform?</a></li><li><a href="#what-is-google-cloud-iot-core" class="table-of-contents__link toc-highlight">What is Google Cloud IoT Core?</a></li><li><a href="#what-is-google-cloud-console" class="table-of-contents__link toc-highlight">What is Google Cloud Console?</a></li></ul></li><li><a href="#connecting-wio-terminal-to-google-cloud-iot-core-via-mqtt" class="table-of-contents__link toc-highlight">Connecting Wio Terminal to Google Cloud IoT Core via MQTT</a><ul><li><a href="#google-cloud-console-set-up" class="table-of-contents__link toc-highlight">Google Cloud Console Set Up</a></li><li><a href="#arduino-set-up-with-wio-terminal" class="table-of-contents__link toc-highlight">Arduino Set Up with Wio Terminal</a></li><li><a href="#display-telemetry-data" class="table-of-contents__link toc-highlight">Display Telemetry Data</a></li><li><a href="#how-to-add-other-sensors" class="table-of-contents__link toc-highlight">How to Add Other Sensors?</a></li><li><a href="#how-to-add-other-sensors-and-visualize-data-on-dashboards" class="table-of-contents__link toc-highlight">How to Add Other Sensors And Visualize Data on Dashboards?</a></li></ul></li><li><a href="#tech-support" class="table-of-contents__link toc-highlight">Tech Support</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docusaurus_wiki/About">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://forum.seeedstudio.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Form<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.com/invite/QqMgVwHT3X" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/seeedstudio" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.seeedstudio.com/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/c1ev0ps/docusaurus_wiki" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Seeed Studio, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/docusaurus_wiki/assets/js/runtime~main.8f55fba0.js"></script>
<script src="/docusaurus_wiki/assets/js/main.3a7959e5.js"></script>
</body>
</html>